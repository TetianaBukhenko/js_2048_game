!function(){function e(e,t,n,r,i,a,l){try{var o=e[a](l),s=o.value}catch(e){n(e);return}o.done?t(s):Promise.resolve(s).then(r,i)}"function"==typeof SuppressedError&&SuppressedError;function t(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function n(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function r(e,t){var r=n(e,t,"get");return r.get?r.get.call(e):r.value}function i(e,t,n){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function a(e,t,r){var i=n(e,t,"set");return!function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=n}}(e,i,r),r}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],l=!0,o=!1;try{for(i=i.call(e);!(l=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);l=!0);}catch(e){o=!0,r=e}finally{try{l||null==i.return||i.return()}finally{if(o)throw r}}return a}}(e,t)||u(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f=function(){function e(n){t(this,e),n?(this.initialState=n,this.board=JSON.parse(JSON.stringify(n))):this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.gameIsStarted=!1,this.mergedTiles=[],this.mergedTilesValues=[],this.cellState=this.createCellState(n)}return o(e,[{key:"moveLeft",value:function(){if(this.gameIsStarted&&this.canMoveLeft()){this.moveCells(this.board);var e=this.newTile(),t=e.cell,n=e.randomValue;return this.slideTiles(this.cellState).finally(function(){t&&(t.tile=new b(t,n))})}}},{key:"moveRight",value:function(){if(this.gameIsStarted&&this.canMoveRight()){var e=this.getReversed(this.board),t=this.moveCells(e);this.board=this.getReversed(t);var n=this.newTile(),r=n.cell,i=n.randomValue;return this.slideTiles(this.cellState.map(function(e){return h(e).reverse()})).finally(function(){r&&(r.tile=new b(r,i))})}}},{key:"moveUp",value:function(){if(this.gameIsStarted&&this.canMoveUp()){var e=this.getElementsByColumn(this.board),t=this.moveCells(e);this.board=this.getElementsByColumn(t);var n=this.newTile(),r=n.cell,i=n.randomValue;return this.slideTiles(this.cellsByColumn).finally(function(){r&&(r.tile=new b(r,i))})}}},{key:"moveDown",value:function(){if(this.gameIsStarted&&this.canMoveDown()){var e=this.getElementsByColumn(this.board),t=this.getReversed(e),n=this.moveCells(t),r=this.getReversed(n);this.board=this.getElementsByColumn(r);var i=this.newTile(),a=i.cell,l=i.randomValue;return this.slideTiles(this.cellsByColumn.map(function(e){return h(e).reverse()})).finally(function(){a&&(a.tile=new b(a,l))})}}},{key:"getScore",value:function(){return this.mergedTilesValues.reduce(function(e,t){return e+t},0)}},{key:"getState",value:function(){return this.board}},{key:"getStatus",value:function(){return this.isWinner()?"win":this.gameIsStarted&&this.noMovesPossible?"lose":this.gameIsStarted?"playing":"idle"}},{key:"start",value:function(){var e=this.newTile(),t=e.cell,n=e.randomValue;t&&(t.tile=new b(t,n));var r=this.newTile(),i=r.cell,a=r.randomValue;i&&(i.tile=new b(i,a)),this.gameIsStarted=!0}},{key:"restart",value:function(){this.initialState?this.board=JSON.parse(JSON.stringify(this.initialState)):this.board.forEach(function(e){for(var t=0;t<e.length;t++)e[t]&&(e[t]=0)}),this.mergedTiles=[],this.mergedTilesValues=[],this.gameIsStarted=!1,this.cellState&&this.cellState.forEach(function(e){for(var t=0;t<e.length;t++){var n=e[t];n.tile&&(n.tile.remove(),n.tile=null),n.mergeTile&&(n.mergeTile.remove(),n.tile=null)}}),this.cellState=this.createCellState(this.initialState)}},{key:"createCellState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(document.querySelectorAll(".field-row")).map(function(t,n){for(var r=h(t.children),i=[],a=0;a<r.length;a++){var l=new m(r[a],a,n);if(e.length>0){var o=e[n][a];if(0!==o){var s=new b(l,o);l.tile=s}}i.push(l)}return i})}},{key:"randomCell",get:function(){var e=[];if(this.board.forEach(function(t,n){for(var r=0;r<t.length;r++)t[r]&&0!==t[r]||e.push([r,n])}),0!==e.length){var t=Math.floor(Math.random()*e.length);return e[t]}}},{key:"newTile",value:function(){var e,t=this.randomCell;if(t){var n=c(t,2),r=n[0],i=n[1],a=.1>=Math.random()?4:2;return this.board[i][r]=a,this.cellState[i]&&(e=this.cellState[i][r]),{cell:e,randomValue:a}}}},{key:"getCoords",value:function(e){return{x:+e.dataset.x,y:+e.dataset.y}}},{key:"moveCells",value:function(e){var t=this,n=function(n){for(var r=e[n],i=1;i<r.length;i++)!function(e){var i=function(e){var i=r[e],o=t.mergedTiles.length>0&&t.mergedTiles.find(function(t){var r=c(t,2),i=r[0],a=r[1];return e===i&&n===a});if(!t.canCellAcceptTile(i,a,o))return"break";l=e},a=r[e];if(0!==a){for(var l=void 0,o=e-1;o>=0&&"break"!==i(o);o--);(l||0===l)&&(r[l]===r[e]&&(t.mergedTiles.push([l,n]),r[l]=2*r[e],t.mergedTilesValues.push(2*r[e])),0===r[l]&&(r[l]=r[e]),r[e]=0)}}(i)};this.mergedTiles=[];for(var r=0;r<e.length;r++)n(r);return e}},{key:"canCellAcceptTile",value:function(e,t,n){return!e||e===t&&!n}},{key:"cellsByColumn",get:function(){for(var e=function(e){n.push(t.map(function(t){return t[e]}))},t=this.cellState,n=[],r=0;r<t.length;r++)e(r);return n}},{key:"tableByColumn",get:function(){for(var e=function(e){n.push(t.map(function(t){return t[e]}))},t=this.cellState,n=[],r=0;r<t.length;r++)e(r);return n}},{key:"slideTiles",value:function(e){return Promise.all(e.flatMap(function(e){for(var t=[],n=1;n<e.length;n++){var r=e[n].tile,i=e[n];if(r){for(var a=void 0,l=n-1;l>=0;l--){var o=e[l];if(!o.canAcceptTile(r))break;a=o}a&&(a.tile?(t.push(r.waitForTransition()),a.mergeTile||(a.mergeTile=r)):(a.tile=r,t.push(r.waitForTransition())),i.tile=null)}}return t}))}},{key:"canMove",value:function(e){var t=this;return e.some(function(e,n){return e.some(function(n,r){return 0!==r&&0!==n&&t.canCellAcceptTile(e[r-1],n,!1)})})}},{key:"getElementsByColumn",value:function(e){for(var t=function(t){n.push(e.map(function(e){return e[t]}))},n=[],r=0;r<e.length;r++)t(r);return n}},{key:"getReversed",value:function(e){return e.map(function(e){return h(e).reverse()})}},{key:"canMoveLeft",value:function(){return this.canMove(this.board)}},{key:"canMoveRight",value:function(){var e=this.getReversed(this.board);return this.canMove(e)}},{key:"canMoveUp",value:function(){var e=this.getElementsByColumn(this.board);return this.canMove(e)}},{key:"canMoveDown",value:function(){var e=this.getElementsByColumn(this.board),t=this.getReversed(e);return this.canMove(t)}},{key:"noMovesPossible",get:function(){return!this.canMoveDown()&&!this.canMoveUp()&&!this.canMoveLeft()&&!this.canMoveRight()}},{key:"isWinner",value:function(){return this.mergedTilesValues.some(function(e){return 2048===e})}}]),e}(),v=new WeakMap,d=new WeakMap,m=function(){function e(n,r,a){t(this,e),i(this,v,{writable:!0,value:void 0}),i(this,d,{writable:!0,value:void 0}),this.cellElement=n,this.x=r,this.y=a}return o(e,[{key:"tile",get:function(){return r(this,v)},set:function(e){a(this,v,e),e&&(this.tile.x=+this.x,this.tile.y=+this.y)}},{key:"mergeTile",get:function(){return r(this,d)},set:function(e){a(this,d,e),e&&(r(this,d).x=this.x,r(this,d).y=this.y)}},{key:"canAcceptTile",value:function(e){return!this.tile||this.tile.value===e.value&&!this.mergeTile}},{key:"mergeTiles",value:function(){this.tile&&r(this,d)&&(this.tile.value=+this.tile.value+ +r(this,d).value,r(this,d).remove(),a(this,d,null))}}]),e}(),y=new WeakMap,g=new WeakMap,p=new WeakMap,b=function(){function e(n,r){t(this,e),i(this,y,{writable:!0,value:void 0}),i(this,g,{writable:!0,value:void 0}),i(this,p,{writable:!0,value:void 0});var l=document.createElement("div"),o=n.cellElement,s=n.x,u=n.y;l.style.setProperty("--coord-y",u),l.style.setProperty("--coord-x",s),l.textContent=r,l.className="field-cell game-cell field-cell--".concat(r),this.tileElement=l,a(this,y,s),a(this,g,u),a(this,p,+r),o.append(l)}return o(e,[{key:"x",get:function(){return r(this,y)},set:function(e){a(this,y,+e),this.tileElement.style.setProperty("--coord-x",+e)}},{key:"y",get:function(){return r(this,g)},set:function(e){a(this,g,+e),this.tileElement.style.setProperty("--coord-y",+e)}},{key:"value",get:function(){return r(this,p)},set:function(e){e&&(a(this,p,+e),this.tileElement.textContent=e.toString(),this.tileElement.className="field-cell game-cell field-cell--".concat(e))}},{key:"remove",value:function(){this.tileElement.remove()}},{key:"waitForTransition",value:function(){var e=this;return new Promise(function(t){e.tileElement.addEventListener("transitionend",t,{once:!0})})}}]),e}(),w=new f,S=document.querySelector("button"),k=document.querySelectorAll(".message"),T=document.querySelector(".message-start");function E(){document.addEventListener("keydown",C,{once:!0})}function C(e){return M.apply(this,arguments)}function M(){var t;return t=function(e){return function(e,t){var n,r,i,a,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(s){return function(o){if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(l=0)),l;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=(i=l.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,function(t){switch(t.label){case 0:switch(e.key){case"ArrowLeft":return[3,1];case"ArrowRight":return[3,3];case"ArrowUp":return[3,5];case"ArrowDown":return[3,7]}return[3,9];case 1:return[4,w.moveLeft()];case 2:case 4:case 6:case 8:return t.sent(),[3,10];case 3:return[4,w.moveRight()];case 5:return[4,w.moveUp()];case 7:return[4,w.moveDown()];case 9:return E(),[2];case 10:var n;return w.cellState.flat().forEach(function(e){e.mergeTiles()}),n=w.getStatus(),k.forEach(function(e){e.classList.contains("message-".concat(n))&&e.classList.remove("hidden")}),x(w.getScore()),w.isWinner()&&w.noMovesPossible()||E(),[2]}})},(M=function(){var n=this,r=arguments;return new Promise(function(i,a){var l=t.apply(n,r);function o(t){e(l,i,a,o,s,"next",t)}function s(t){e(l,i,a,o,s,"throw",t)}o(void 0)})}).apply(this,arguments)}function x(e){document.querySelector(".game-score").textContent=e}S.addEventListener("click",function(){var e=S.classList.contains("start");S.textContent=e?"Restart":"Start",e?(w.start(),S.classList.replace("start","restart")):(w.restart(),x(0),S.classList.replace("restart","start"),k.forEach(function(e){e.classList.contains("hiiden")||e.classList.add("hidden")})),T.classList.toggle("hidden")}),E()}();
//# sourceMappingURL=index.faf82c65.js.map
